<!DOCTYPE html>
<html lang="tr">
<head>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Aura Social">
<link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3661/3661317.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Aura Social Pro</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        :root { --primary: #007aff; --bg: #0a0b10; --card: #16171d; --text: #f2f2f7; --gray: #8e8e93; --story-grad: linear-gradient(45deg, #ff9500, #ff2d55, #5856d6); }
        * { -webkit-tap-highlight-color: transparent; user-select: none; -webkit-user-select: none; box-sizing: border-box; }
        input, textarea { user-select: text !important; -webkit-user-select: text !important; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; margin: 0; display: flex; justify-content: center; height: 100vh; overflow: hidden; }
        #app-container { width: 100%; max-width: 480px; height: 100vh; display: flex; flex-direction: column; position: relative; }
        
        /* Tasarƒ±m Detaylarƒ± */
        .header { padding: 55px 20px 15px; background: rgba(10,11,16,0.85); backdrop-filter: blur(20px); font-size: 24px; font-weight: 800; border-bottom: 0.5px solid rgba(255,255,255,0.1); z-index: 100; display: flex; justify-content: space-between; }
        #stories-container { display: flex; gap: 14px; padding: 15px 20px; overflow-x: auto; border-bottom: 0.5px solid rgba(255,255,255,0.1); scrollbar-width: none; }
        .story-circle { width: 66px; height: 66px; border-radius: 50%; background: var(--story-grad); padding: 2.5px; display: flex; align-items: center; justify-content: center; }
        .story-content { width: 100%; height: 100%; border-radius: 50%; background: var(--bg); border: 2px solid var(--bg); display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold; text-align: center; }
        
        .page { display: none; flex: 1; flex-direction: column; overflow: hidden; padding-bottom: 100px; }
        .active { display: flex; }
        .content { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }

        .message { max-width: 80%; padding: 12px 18px; border-radius: 24px; font-size: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .me { align-self: flex-end; background: var(--primary); border-bottom-right-radius: 4px; }
        .you { align-self: flex-start; background: var(--card); border-bottom-left-radius: 4px; }
        .dm-label { font-size: 10px; color: #ff9500; font-weight: bold; margin-bottom: 2px; display: block; }

        .nav-bar { position: absolute; bottom: 30px; left: 20px; right: 20px; background: rgba(22,23,29,0.8); backdrop-filter: blur(25px); border-radius: 40px; padding: 14px; display: flex; justify-content: space-around; border: 0.5px solid rgba(255,255,255,0.15); }
        .nav-item { font-size: 24px; opacity: 0.4; transition: 0.3s; cursor: pointer; }
        .nav-item.active-nav { opacity: 1; transform: translateY(-3px); }

        .input-bar { padding: 15px 20px; display: flex; gap: 12px; margin-bottom: 90px; }
        input { flex: 1; background: var(--card); border: none; padding: 14px 20px; border-radius: 30px; color: white; outline: none; }
    </style>
</head>
<body>

<div id="app-container">
    <div class="header" id="main-title">Aura Social</div>
    
    <div id="home" class="page active">
        <div id="stories-container">
            <div onclick="hikayeEkle()" style="text-align:center;"><div class="story-circle" style="background:var(--gray);"><div class="story-content">+</div></div></div>
            <div id="stories-list" style="display:flex; gap:14px;"></div>
        </div>
        <div class="content" id="chat-area"></div>
        <div class="input-bar">
            <input type="text" id="m" placeholder="Mesaj yaz..." autocomplete="off">
            <button onclick="gonder()" style="background:none; border:none; color:var(--primary); font-weight:bold;">G√∂nder</button>
        </div>
    </div>

    <div id="explore" class="page">
        <div class="content" id="explore-area"></div>
    </div>

    <div id="profile" class="page">
        <div class="content" style="text-align:center;">
            <div style="width:120px; height:120px; border-radius:50%; background:var(--card); margin:0 auto 20px; border:3px solid var(--primary); overflow:hidden;">
                <img id="my-pic" src="https://via.placeholder.com/150" style="width:100%; height:100%; object-fit:cover;">
            </div>
            <h2 id="p-name">ƒ∞sim</h2>
            <input type="text" id="p-foto" placeholder="Fotoƒüraf URL..." style="margin-bottom:10px;">
            <textarea id="p-bio" placeholder="Biyografin..." style="width:100%; background:var(--card); color:white; border:none; border-radius:20px; padding:15px; height:100px; outline:none;"></textarea>
            <button onclick="profilKaydet()" style="width:100%; background:var(--primary); color:white; border:none; padding:15px; border-radius:20px; font-weight:bold; margin-top:15px;">KAYDET</button>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active-nav" onclick="switchPage('home', 'Aura Social', this)">üè†</div>
        <div class="nav-item" onclick="switchPage('explore', 'Ke≈üfet', this)">üîç</div>
        <div class="nav-item" onclick="switchPage('profile', 'Profilim', this)">üë§</div>
    </div>
</div>

<script>
    var ws;
    var benimNick = prompt("ƒ∞sminiz:") || "Anonim";
    var aktifDMPartner = null;

    ws = new WebSocket("ws://" + window.location.host + "/ws/" + benimNick);

    ws.onmessage = function(e) {
        var d = JSON.parse(e.data);
        var chat = document.getElementById('chat-area');
        var side = (d.user === benimNick) ? 'me' : 'you';
        var dmEtiketi = d.is_dm ? '<span class="dm-label">√ñZEL MESAJ</span>' : '';
        
        chat.innerHTML += `<div class="message ${side}">${dmEtiketi}<small style="display:block;font-size:10px;opacity:0.6;">${d.user}</small>${d.text}</div>`;
        chat.scrollTop = chat.scrollHeight;
    };

    function gonder() {
        var i = document.getElementById("m");
        if(i.value.trim()){
            let p = { text: i.value };
            if(aktifDMPartner) { p.tip = "dm"; p.hedef = aktifDMPartner; }
            ws.send(JSON.stringify(p));
            i.value = "";
        }
    }

    function switchPage(id, title, el) {
        if(id === 'home' && title === 'Aura Social') aktifDMPartner = null; // Genel odaya d√∂n
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('main-title').innerText = title;
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active-nav'));
        el.classList.add('active-nav');
        if(id==='explore') yukleKesfet();
    }

    function dmBaslat(user) {
        aktifDMPartner = user;
        switchPage('home', '√ñzel: ' + user, document.querySelector('.nav-item'));
        document.getElementById('chat-area').innerHTML = `<p style="text-align:center;color:var(--gray);font-size:12px;">${user} ile √∂zel sohbet</p>`;
    }

    async function yukleKesfet() {
        let r = await fetch("/kesfet");
        let u = await r.json();
        let a = document.getElementById("explore-area"); a.innerHTML = "";
        u.forEach(x => {
            a.innerHTML += `<div onclick="dmBaslat('${x.username}')" style="background:var(--card); padding:20px; border-radius:25px; margin-bottom:12px; display:flex; align-items:center; gap:15px; border:0.5px solid rgba(255,255,255,0.05); cursor:pointer;">
                <img src="${x.foto || 'https://via.placeholder.com/50'}" style="width:50px; height:50px; border-radius:50%; object-fit:cover;">
                <div><b>${x.username}</b><br><small style="color:var(--gray)">Mesaj atmak i√ßin dokun</small></div>
            </div>`;
        });
    }

    async function profilKaydet() {
        let b = document.getElementById("p-bio").value;
        let f = document.getElementById("p-foto").value;
        await fetch("/profil-guncelle", {method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({username:benimNick, bio:b, foto:f})});
        alert("G√ºncellendi! ‚ú®");
    }

    function hikayeEkle() {
        let n = prompt("Notun:");
        if(n) document.getElementById("stories-list").innerHTML += `<div class="story-circle"><div class="story-content">${n}</div></div>`;
    }
</script>
</body>
</html>