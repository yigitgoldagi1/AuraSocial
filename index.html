<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Aura Elite</title>
    <style>
        :root { --bg: #000; --surface: #121212; --accent: #fff; --border: rgba(255,255,255,0.1); }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: white; margin: 0; height: 100vh; overflow: hidden; }

        /* Giri≈ü Ekranƒ± - Her Zaman En √ústte */
        #auth-overlay { 
            position: fixed; inset: 0; background: #000; z-index: 99999; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
        }
        
        /* Sayfa D√ºzeni */
        .page { position: absolute; inset: 0; opacity: 0; transform: scale(0.98); transition: all 0.3s ease; pointer-events: none; display: flex; flex-direction: column; padding-bottom: 80px; }
        .page.active { opacity: 1; transform: scale(1); pointer-events: auto; }
        
        header { padding: 60px 25px 15px; border-bottom: 1px solid var(--border); background: #000; font-size: 24px; font-weight: 800; }

        /* Navigasyon Barƒ± */
        nav { position: fixed; bottom: 20px; left: 20px; right: 20px; height: 60px; background: rgba(30,30,30,0.8); backdrop-filter: blur(20px); border-radius: 25px; border: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; z-index: 1000; }
        .nav-item { color: #555; font-size: 22px; cursor: pointer; }
        .nav-item.active { color: white; }

        /* Sohbet & Liste */
        #chat-penceresi { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 8px; }
        .bubble { max-width: 75%; padding: 12px 16px; border-radius: 18px; background: var(--surface); border: 1px solid var(--border); font-size: 15px; }
        .me { align-self: flex-end; background: #333; }
        
        .user-grid { padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card { background: var(--surface); border-radius: 20px; padding: 20px; text-align: center; border: 1px solid var(--border); }
        
        /* Inputlar */
        input { width: 250px; padding: 15px; background: #1a1a1a; color: white; border-radius: 12px; border: 1px solid #333; outline: none; margin-bottom: 10px; }
        .btn { width: 250px; padding: 15px; background: white; color: black; font-weight: bold; border-radius: 12px; border: none; }
    </style>
</head>
<body>

<div id="auth-overlay">
    <h1 style="font-size: 3.5rem; margin-bottom: 10px;">Aura</h1>
    <input type="text" id="reg-name" placeholder="ƒ∞sminiz nedir?">
    <button onclick="kayitOl()" class="btn">KE≈ûFETMEYE BA≈ûLA</button>
</div>

<div id="page-discover" class="page active"><header>Ke≈üfet</header><div class="user-grid" id="user-list"></div></div>
<div id="page-chat" class="page">
    <header id="chat-title">Sohbet</header>
    <div id="chat-penceresi"></div>
    <div style="padding:15px; display:flex; gap:10px; background:#000;">
        <input type="text" id="msg-input" style="flex:1; margin:0;" placeholder="Mesaj...">
        <button onclick="mesajAt()" style="width:50px; border-radius:50%; background:white; color:black; font-weight:bold;">‚Üë</button>
    </div>
</div>
<div id="page-profile" class="page">
    <header>Profil</header>
    <div style="padding:40px; text-align:center;">
        <h2 id="disp-name"></h2>
        <button onclick="cikis()" style="color:red; background:none; border:none; font-weight:bold; margin-top:50px;">Oturumu Kapat</button>
    </div>
</div>

<nav>
    <div class="nav-item active" onclick="sayfaSec('discover', 0)">üîç</div>
    <div class="nav-item" onclick="sayfaSec('chat', 1)">üí¨</div>
    <div class="nav-item" onclick="sayfaSec('profile', 2)">üë§</div>
</nav>

<script>
    let socket;
    let hedef = null;
    let localUser = JSON.parse(localStorage.getItem('aura_data'));

    // Ba≈ülangƒ±√ß Ayarƒ±
    if (localUser && localUser.name) {
        girisYap(localUser.name);
    }

    function kayitOl() {
        const isim = document.getElementById('reg-name').value.trim();
        if (isim) {
            localStorage.setItem('aura_data', JSON.stringify({ name: isim }));
            girisYap(isim);
        }
    }

    function girisYap(isim) {
        document.getElementById('auth-overlay').style.display = 'none';
        document.getElementById('disp-name').innerText = isim;
        
        // WebSocket Baƒülantƒ±sƒ±
        const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        socket = new WebSocket(wsProtocol + '//' + window.location.host + '/ws/' + isim);
        
        socket.onmessage = (e) => {
            const data = JSON.parse(e.data);
            if(data.text && (!data.hedef || data.hedef === isim || data.user === isim)) {
                const chat = document.getElementById('chat-penceresi');
                const div = document.createElement('div');
                div.className = `bubble ${data.user === isim ? 'me' : ''}`;
                div.innerHTML = `<small style="display:block;color:#666;font-size:10px;">${data.user}</small>${data.text}`;
                chat.appendChild(div);
                chat.scrollTop = chat.scrollHeight;
            }
            gridGuncelle(data.user);
        };
    }

    function sayfaSec(pId, idx) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('page-' + pId).classList.add('active');
        document.querySelectorAll('.nav-item')[idx].classList.add('active');
    }

    function mesajAt() {
        const i = document.getElementById('msg-input');
        if (i.value && socket) {
            socket.send(JSON.stringify({ text: i.value, hedef: hedef }));
            i.value = '';
        }
    }

    function gridGuncelle(u) {
        const isim = JSON.parse(localStorage.getItem('aura_data')).name;
        if(u === isim) return;
        const list = document.getElementById('user-list');
        if([...list.querySelectorAll('h4')].some(h => h.innerText === u)) return;
        const card = document.createElement('div');
        card.className = 'card';
        card.onclick = () => { hedef = u; document.getElementById('chat-title').innerText = u; sayfaSec('chat', 1); };
        card.innerHTML = `<div style="width:40px;height:40px;background:#222;border-radius:10px;margin:0 auto 10px;display:flex;align-items:center;justify-content:center;">${u[0]}</div><h4>${u}</h4>`;
        list.appendChild(card);
    }

    function cikis() { localStorage.clear(); location.reload(); }
</script>
</body>
</html>