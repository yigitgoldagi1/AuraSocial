<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Aura Hybrid Elite</title>
    <style>
        :root {
            --bg: #000;
            --surface: #121212;
            --accent: #fff;
            --border: rgba(255,255,255,0.12);
            --text-dim: #8e8e8e;
            --whatsapp-green: #25D366;
            --ease: cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
            background: var(--bg); color: white; margin: 0; height: 100vh; overflow: hidden;
        }

        /* --- SAYFA GE√áƒ∞≈ûLERƒ∞ --- */
        .page {
            position: absolute; inset: 0; opacity: 0; transform: scale(0.98);
            transition: all 0.5s var(--ease); pointer-events: none;
            display: flex; flex-direction: column; padding-bottom: 90px;
        }
        .page.active { opacity: 1; transform: scale(1); pointer-events: auto; }

        header {
            padding: 60px 25px 20px; font-size: 26px; font-weight: 800;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(30px);
            border-bottom: 1px solid var(--border); z-index: 10;
        }

        /* --- SOHBET ALANI --- */
        #chat-penceresi { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 6px; }
        
        .bubble-container { display: flex; flex-direction: column; width: 100%; margin-bottom: 4px; }
        .bubble-container.me { align-items: flex-end; }
        .bubble-container.others { align-items: flex-start; }

        .bubble {
            max-width: 75%; padding: 10px 14px; border-radius: 20px; font-size: 15px;
            position: relative; animation: bubblePop 0.3s var(--ease);
        }
        @keyframes bubblePop { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .me .bubble { background: #373737; color: white; border-bottom-right-radius: 4px; }
        .others .bubble { background: var(--surface); border: 1px solid var(--border); border-bottom-left-radius: 4px; }

        .meta { display: flex; align-items: center; gap: 4px; font-size: 10px; margin-top: 4px; color: var(--text-dim); justify-content: flex-end; }
        .ticks { color: var(--whatsapp-green); }

        /* --- PROFƒ∞L EDƒ∞T√ñR√ú (ELƒ∞TE) --- */
        .profile-content { padding: 30px; display: flex; flex-direction: column; align-items: center; }
        
        .avatar-wrapper {
            position: relative; width: 120px; height: 120px; margin-bottom: 20px;
            border-radius: 40px; background: #1a1a1a; border: 2px solid var(--border);
            overflow: hidden; cursor: pointer; transition: 0.3s;
        }
        .avatar-wrapper:active { transform: scale(0.95); }
        .avatar-wrapper img { width: 100%; height: 100%; object-fit: cover; }
        .avatar-placeholder { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 40px; font-weight: bold; }
        
        .edit-overlay {
            position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.6);
            padding: 5px 0; text-align: center; font-size: 10px; font-weight: bold;
        }

        .bio-input {
            width: 100%; background: var(--surface); border: 1px solid var(--border);
            padding: 15px; border-radius: 15px; color: white; margin-top: 15px;
            font-size: 15px; outline: none; transition: 0.3s;
        }
        .bio-input:focus { border-color: var(--accent); }

        /* --- NAVƒ∞GASYON --- */
        nav {
            position: fixed; bottom: 25px; left: 25px; right: 25px;
            height: 65px; background: rgba(30, 30, 30, 0.7);
            backdrop-filter: blur(25px); border-radius: 30px;
            border: 1px solid var(--border); display: flex;
            justify-content: space-around; align-items: center; z-index: 1000;
        }
        .nav-item { color: #666; font-size: 22px; transition: 0.3s; padding: 10px; }
        .nav-item.active { color: white; transform: translateY(-5px); }

        /* --- INPUT BAR --- */
        .input-bar { padding: 15px 20px 35px; display: flex; gap: 12px; background: var(--bg); border-top: 1px solid var(--border); }
        .message-input { flex: 1; background: #1c1c1e; border: none; padding: 12px 20px; border-radius: 25px; color: white; font-size: 16px; outline: none; }
    </style>
</head>
<body>

<div id="page-discover" class="page active"><header>Ke≈üfet</header></div>

<div id="page-chat" class="page">
    <header>Mesajlar</header>
    <div id="chat-penceresi"></div>
    <div class="input-bar">
        <input type="text" id="msg-input" class="message-input" placeholder="Mesaj yazƒ±n...">
        <button onclick="sendMsg()" style="background:white; border:none; width:45px; height:45px; border-radius:50%; font-size:18px;">‚Üë</button>
    </div>
</div>

<div id="page-profile" class="page">
    <header>Profil D√ºzenle</header>
    <div class="profile-content">
        <div class="avatar-wrapper" onclick="document.getElementById('file-input').click()">
            <div id="p-img-container">
                <div class="avatar-placeholder" id="p-avatar">?</div>
            </div>
            <div class="edit-overlay">DEƒûƒ∞≈ûTƒ∞R</div>
        </div>
        <input type="file" id="file-input" hidden accept="image/*" onchange="previewImage(this)">

        <input type="text" id="p-name-input" class="bio-input" placeholder="G√∂r√ºnen ƒ∞sim" onchange="saveProfile()">
        <textarea id="p-bio-input" class="bio-input" placeholder="Biyografinizi yazƒ±n..." rows="3" onchange="saveProfile()"></textarea>
        
        <button onclick="logout()" style="margin-top: 50px; color: #ff3b30; background: none; border: none; font-weight: bold; font-size: 12px; letter-spacing: 1px;">OTURUMU KAPAT</button>
    </div>
</div>

<nav>
    <div class="nav-item active" onclick="showPage('discover', this)">üîç</div>
    <div class="nav-item" onclick="showPage('chat', this)">üí¨</div>
    <div class="nav-item" onclick="showPage('profile', this)">üë§</div>
</nav>

<script>
    let socket;
    let user = JSON.parse(localStorage.getItem('aura_user')) || { name: 'Anonim', bio: '', photo: null };

    // Profil Y√ºkleme
    window.onload = () => {
        document.getElementById('p-name-input').value = user.name;
        document.getElementById('p-bio-input').value = user.bio;
        updateAvatarView();
        connect();
    };

    function showPage(pId, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('page-' + pId).classList.add('active');
        el.classList.add('active');
    }

    // Fotoƒüraf √ñnizleme ve Kaydetme
    function previewImage(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                user.photo = e.target.result;
                saveProfile();
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    function saveProfile() {
        user.name = document.getElementById('p-name-input').value;
        user.bio = document.getElementById('p-bio-input').value;
        localStorage.setItem('aura_user', JSON.stringify(user));
        updateAvatarView();
    }

    function updateAvatarView() {
        const container = document.getElementById('p-img-container');
        if (user.photo) {
            container.innerHTML = `<img src="${user.photo}" alt="Profil">`;
        } else {
            container.innerHTML = `<div class="avatar-placeholder">${user.name[0].toUpperCase()}</div>`;
        }
    }

    function connect() {
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        socket = new WebSocket(protocol + '//' + window.location.host + '/ws/' + user.name);
        socket.onmessage = (e) => {
            const data = JSON.parse(e.data);
            if(data.text) appendMsg(data.user, data.text, data.user === user.name);
        };
    }

    function sendMsg() {
        const i = document.getElementById('msg-input');
        if(i.value && socket) {
            socket.send(JSON.stringify({ text: i.value }));
            i.value = '';
        }
    }

    function appendMsg(u, t, m) {
        const chat = document.getElementById('chat-penceresi');
        const now = new Date();
        const time = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
        const container = document.createElement('div');
        container.className = `bubble-container ${m ? 'me' : 'others'}`;
        container.innerHTML = `
            ${!m ? `<span style="font-size:10px; color:#555; margin-left:8px; margin-bottom:2px;">${u}</span>` : ''}
            <div class="bubble">
                ${t}
                <div class="meta">${time} ${m ? '<span class="ticks">‚úì‚úì</span>' : ''}</div>
            </div>`;
        chat.appendChild(container);
        chat.scrollTop = chat.scrollHeight;
    }

    function logout() { localStorage.clear(); location.reload(); }
</script>
</body>
</html>