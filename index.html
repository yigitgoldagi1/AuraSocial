<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Aura Social</title>
    <style>
        :root {
            --bg: #000;
            --surface: #121212;
            --accent: #8e2de2;
            --glass: rgba(15, 15, 15, 0.85);
            --border: rgba(255, 255, 255, 0.1);
            /* Alt bar y√ºksekliƒüi + g√ºvenli alan */
            --nav-height: 85px; 
        }

        body, html {
            margin: 0; padding: 0; height: 100%;
            background-color: var(--bg); color: white;
            font-family: -apple-system, system-ui, sans-serif;
            overflow: hidden;
        }

        /* --- SAYFA Sƒ∞STEMƒ∞ --- */
        .wrapper {
            display: flex; width: 300%; height: 100vh;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #tab1:checked ~ .wrapper { transform: translateX(0); }
        #tab2:checked ~ .wrapper { transform: translateX(-33.33%); }
        #tab3:checked ~ .wrapper { transform: translateX(-66.66%); }

        section {
            width: 33.33%; height: 100%; display: flex; flex-direction: column;
            padding-top: 60px; /* Header bo≈üluƒüu */
            box-sizing: border-box;
            position: relative;
        }

        header {
            position: fixed; top: 0; width: 100%; height: 60px;
            background: var(--glass); backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; font-size: 20px; z-index: 1000;
        }

        /* --- SOHBET AKI≈ûI --- */
        #chat-content {
            flex: 1; overflow-y: auto; padding: 20px;
            display: flex; flex-direction: column; gap: 10px;
            /* Alt bar ve input alanƒ± i√ßin padding */
            padding-bottom: 160px; 
        }

        .bubble {
            max-width: 80%; padding: 12px 16px; border-radius: 20px;
            background: var(--surface); border: 1px solid var(--border); font-size: 15px;
        }
        .me { align-self: flex-end; background: var(--accent); border-color: transparent; }

        /* --- MESAJ YAZMA ALANI (D√úZELTƒ∞LDƒ∞) --- */
        .input-container {
            position: absolute; 
            bottom: var(--nav-height); /* Alt barƒ±n tam √ºst√ºne koyduk */
            left: 0; right: 0;
            padding: 12px 15px;
            background: var(--bg);
            border-top: 1px solid var(--border);
            display: flex; gap: 10px; align-items: center;
            z-index: 500;
        }

        .input-elite {
            flex: 1; padding: 12px 18px; border-radius: 25px;
            border: 1px solid #333; background: #1a1a1a; color: white;
            font-size: 16px; outline: none;
        }

        /* --- ALT NAVƒ∞GASYON --- */
        .nav-bar {
            position: fixed; bottom: 0; width: 100%; height: var(--nav-height);
            background: var(--glass); backdrop-filter: blur(30px);
            border-top: 1px solid var(--border);
            display: flex; justify-content: space-around; align-items: center;
            padding-bottom: env(safe-area-inset-bottom); z-index: 2000;
        }

        .nav-label {
            display: flex; flex-direction: column; align-items: center;
            color: #555; cursor: pointer; flex: 1;
        }

        input[type="radio"] { display: none; }
        #tab1:checked ~ .nav-bar label[for="tab1"],
        #tab2:checked ~ .nav-bar label[for="tab2"],
        #tab3:checked ~ .nav-bar label[for="tab3"] { color: white; }

        /* --- Gƒ∞Rƒ∞≈û --- */
        #login-gate {
            position: fixed; inset: 0; background: #000; z-index: 5000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

<input type="radio" name="tabs" id="tab1" checked>
<input type="radio" name="tabs" id="tab2">
<input type="radio" name="tabs" id="tab3">

<div id="login-gate">
    <h1 style="font-size: 3rem; letter-spacing: -3px;">Aura</h1>
    <input type="text" id="my-name-input" style="width:250px; padding:15px; border-radius:15px; background:#111; color:white; border:1px solid #333; margin-bottom:15px; text-align:center;" placeholder="Takma Adƒ±n">
    <button onclick="saveUser()" style="width:250px; padding:15px; border-radius:15px; background:white; font-weight:bold; border:none;">BA≈ûLA</button>
</div>

<header>Aura</header>

<div class="wrapper">
    <section id="chats">
        <div id="chat-content">
            <div style="padding: 20px; text-align: center; color: #444;">Sohbet etmek i√ßin birini se√ßin...</div>
        </div>
        
        <div class="input-container">
            <input type="text" id="m-input" class="input-elite" placeholder="Mesaj yazƒ±n...">
            <button onclick="send()" style="background:white; border:none; width:40px; height:40px; border-radius:50%; font-weight:bold;">‚Üë</button>
        </div>
    </section>

    <section id="discover">
        <div style="padding: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 12px;" id="discover-grid">
            </div>
    </section>

    <section id="profile">
        <div style="padding: 40px; text-align: center;">
            <div id="big-avatar" style="width:90px; height:90px; border-radius:30px; background:var(--accent); margin:0 auto 15px; display:flex; align-items:center; justify-content:center; font-size:35px; font-weight:bold;">?</div>
            <h2 id="display-name">ƒ∞sim</h2>
            <button onclick="localStorage.clear(); location.reload();" style="margin-top: 50px; color: #ff3b30; background: none; border: none; font-weight: bold;">Oturumu Kapat</button>
        </div>
    </section>
</div>

<div class="nav-bar">
    <label for="tab1" class="nav-label"><span style="font-size: 24px;">üí¨</span><small>Sohbet</small></label>
    <label for="tab2" class="nav-label"><span style="font-size: 24px;">üîç</span><small>Ke≈üfet</small></label>
    <label for="tab3" class="nav-label"><span style="font-size: 24px;">üë§</span><small>Profil</small></label>
</div>

<script>
    let ws;
    let user = JSON.parse(localStorage.getItem('aura_hybrid_v2'));

    if(user) {
        document.getElementById('login-gate').style.display = 'none';
        document.getElementById('display-name').innerText = user.name;
        document.getElementById('big-avatar').innerText = user.name[0].toUpperCase();
        initSocket();
    }

    function saveUser() {
        const n = document.getElementById('my-name-input').value;
        if(n) {
            localStorage.setItem('aura_hybrid_v2', JSON.stringify({name: n}));
            location.reload();
        }
    }

    function initSocket() {
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        ws = new WebSocket(protocol + '//' + window.location.host + '/ws/' + user.name);
        ws.onmessage = (e) => {
            const data = JSON.parse(e.data);
            if(data.text) {
                const chat = document.getElementById('chat-content');
                const div = document.createElement('div');
                div.className = `bubble ${data.user === user.name ? 'me' : ''}`;
                div.innerHTML = `<small style="display:block; font-size:10px; opacity:0.5;">${data.user}</small>${data.text}`;
                chat.appendChild(div);
                chat.scrollTop = chat.scrollHeight;
            }
            if(data.user !== user.name) updateDiscover(data.user);
        };
    }

    function send() {
        const i = document.getElementById('m-input');
        if(i.value && ws) {
            ws.send(JSON.stringify({text: i.value}));
            i.value = '';
        }
    }

    function updateDiscover(u) {
        const grid = document.getElementById('discover-grid');
        if([...grid.querySelectorAll('h4')].some(h => h.innerText === u)) return;
        const card = document.createElement('div');
        card.style = "background:var(--surface); border-radius:20px; padding:20px; text-align:center; border:1px solid var(--border);";
        card.innerHTML = `<div style="font-size:24px; margin-bottom:8px;">${u[0].toUpperCase()}</div><h4>${u}</h4>`;
        grid.appendChild(card);
    }
</script>
</body>
</html>